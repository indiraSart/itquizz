<div class="results-header text-center mb-5">
    <h1>Quiz-resultater</h1>
    <h2><%= quiz ? quiz.title : 'Quiz' %></h2>
    
    <div class="score-display my-4">
        <div class="display-4">
            <%= typeof score !== 'undefined' ? score : 0 %> / <%= typeof totalPoints !== 'undefined' ? totalPoints : 0 %>
        </div>
        <% 
            // Ensure scorePercentage is properly calculated
            const scoreValue = typeof score !== 'undefined' ? score : 0;
            const totalPointsValue = typeof totalPoints !== 'undefined' ? totalPoints : 1;
            const calculatedPercentage = Math.round((scoreValue / totalPointsValue) * 100) || 0;
        %>
        <div class="progress" style="height: 30px;">
            <div class="progress-bar <%= calculatedPercentage >= 70 ? 'bg-success' : calculatedPercentage >= 40 ? 'bg-warning' : 'bg-danger' %>" 
                 role="progressbar" 
                 style="width: <%= calculatedPercentage %>%;" 
                 aria-valuenow="<%= calculatedPercentage %>" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
                <%= calculatedPercentage %>%
            </div>
        </div>
    </div>
</div>

<div class="results-details">
    <h3>Gjennomgang av spørsmål</h3>
    
    <% if (typeof results !== 'undefined' && results && results.length > 0) { %>
        <% results.forEach((result, index) => { %>
            <div class="card mb-4 <%= result.correct ? 'border-success' : 'border-danger' %>">
                <div class="card-header <%= result.correct ? 'bg-success text-white' : 'bg-danger text-white' %> d-flex justify-content-between">
                    <h5>Spørsmål <%= index + 1 %></h5>
                    <div>
                        <% if (result.correct) { %>
                            <span class="badge bg-light text-dark">Riktig (+<%= result.question.points %> poeng)</span>
                        <% } else { %>
                            <span class="badge bg-light text-dark">Feil (0 poeng)</span>
                        <% } %>
                    </div>
                </div>
                <div class="card-body">
                    <p class="lead"><%= result.question.questionText %></p>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-light">
                                    Ditt svar
                                </div>
                                <div class="card-body">
                                    <%= result.userAnswer || 'Ingen svar gitt' %>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-light">
                                    Riktig svar
                                </div>
                                <div class="card-body">
                                    <%= result.question.correctAnswer %>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <% if (!result.correct) { %>
                        <div class="explanation alert alert-info">
                            <strong>Forklaring:</strong>
                            <p>Det riktige svaret er "<%= result.question.correctAnswer %>".</p>
                        </div>
                    <% } %>
                </div>
            </div>
        <% }) %>
    <% } else { %>
        <div class="alert alert-warning">
            <p>Ingen resultater tilgjengelige.</p>
        </div>
    <% } %>
    
    <div class="d-flex justify-content-between mt-5">
        <a href="/quizzes/<%= quiz && quiz._id ? quiz._id : '#' %>" class="btn btn-primary">Ta igjen</a>
        <a href="/quizzes/browse" class="btn btn-secondary">Bla gjennom flere quizer</a>
    </div>
</div>
